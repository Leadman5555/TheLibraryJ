<form class="outerBox borderBox" [formGroup]="chapterUploadForm" (ngSubmit)="attemptChapterUpload()">
  <p class="infoBox column">
    <b>Upload chapters</b>
    <span>Choose up to 50 files at once. Allowed file formats are: .txt; .doc, .docx (MS Word); .odt (Libre Office).<br>
      The name of the file should be according to one of the following formats (without quote marks): "CHAPTER_NUMBER.EXTENSION" or "CHAPTER_NUMBER - CHAPTER_TITLE.EXTENSION".<br>
      All text inside the file will be treated as chapter text - it is limited to 18000 characters per chapter, with line breaks counting as 4 characters.<br>
      To update a previously uploaded chapter, upload a chapter with the same number, title and chapter text will be replaced accordingly.</span>
  </p>
  <div class="chapterUploadBox column">
    <div class="dropZone"
         (dragover)="onDragOver($event)"
         (dragleave)="onDragLeave($event)"
         (drop)="onDrop($event)"
         [class.active]="isDropZoneActive">
      <input
        type="file"
        id="fileInput"
        hidden
        multiple
        (change)="onFileChange($event)"
        #fileInput
      />
      @if (getFilesControl().value?.length) {
        <div class="fileGrid">
          @for (file of getFilesControl().value; track identifyFile(file)) {
            <div class="fileBox">
              <span class="fileName">{{ file.name }}</span>
              <div class="fileSquare centerVH" (click)="removeFile(file)">X</div>
            </div>
          }
        </div>
      } @else {
        <p>Drag and drop here chapter files you want to upload, or click to browse.</p>
      }
    </div>
    <button type="button" class="sButton" (click)="fileInput.click()">Browse local files</button>
  </div>
  <div class="messageDiv column">
    <div class="errorBox" *ngIf="getFilesControl().errors?.['invalidFileType']">
      Invalid file type. Only .txt, .docx, .doc, or .odt files are allowed.
    </div>
    <div class="errorBox" *ngIf="getFilesControl().errors?.['invalidFileName']">
      One or more of uploaded file names is not in the required format.
    </div>
    <div class="errorBox" *ngIf="getFilesControl().errors?.['maxLength']">
      Upload limit reached. Maximum number of files per upload is 50.
    </div>
    <span *ngIf="!getFilesControl().errors" class="centerVH">{{ uploadMessage }}</span>
    <span *ngIf="this.uploadErrorMessage" class="errorBox">{{ uploadErrorMessage }}</span>
  </div>
  <div class="buttonDiv row">
    <button class="sButton" type="submit">Upload chapters</button>
    <button class="sButton" type="reset" (click)="resetForm()">Clear form</button>
    <button class="sButton" type="button" (click)="windowClosed.emit()">Close</button>
  </div>
</form>
